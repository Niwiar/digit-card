<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Priva Card</title>

</head>

<body>
  <%- include('./template/cookie-consent'); %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/cardAuth.css" />
    <link rel="stylesheet" href="/css/modal.css" />
    <link rel="stylesheet" href="/css/loginInput.css" />

    <div class="modal" role="dialog" tabindex="-1" id="modalCardCreate">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content" id="contentCardCreate">
          <div class="modal-header">
            <h4 class="modal-title">สร้างการ์ดใหม่</h4>
            <button type="button" class="close" style="margin-right: 5px;"><i class="fa-solid fa-xmark"></i></button>
          </div>
          <div class="modal-body">
            <!-- <form action="/card/create" method="post"> -->
            <form action="" method="">
              <div class="mb-3">
                <label class="form-label">ชื่อการ์ด</label>
                <input class="form-control form-control-lg" type="text" name="CardName" id="create_Name"
                  placeholder="ใส่ชื่อการ์ดที่คุณต้องการ" />
              </div>
              <div class="mb-3">
                <label class="form-label">รหัสการ์ด</label>
                <input class="form-control form-control-lg" type="password" name="CardPass" id="create_Pass"
                  placeholder="ใส่รหัสการ์ดที่คุณต้องการ" />
              </div>

            </form>
            <div class="text-center mt-3">
              <button type="submit" class="btn btn-lg btn-primary" id="btn_CardCreate">สร้างการ์ด</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="header">
      <h2 class="text-head">Priva Digital Card</h2>
      <img class="logo-priva" src="/imgs/logos/logo.png" alt="">
    </div>

    <div class="main">
      <div class="row w-100 ">
        <div class="col d-flex justify-content-center align-item-center">
          <div class="card shadow">
            <div class="card-body p-4">
              <form action="" method="">
                <div class="my-4">
                  <h1 class="m-0 fw-bold text-center">Login</h1>
                </div>
                <div class="input-box mb-3">
                  <input type="text" name="CardName" id="auth_Name" required="required">
                  <span>Card Name</span>
                </div>
                <div class="input-box mb-3">
                  <input type="password" name="CardPass" id="auth_Pass" required="required">
                  <span>Password</span>
                </div>
              </form>
              <div class="mb-3">
                <button type="submit" class="btn btn-success w-100" id="btn_CardAuth">
                  <i class="fa-solid fa-right-to-bracket me-2"></i>ลงชื่อเข้าใช้
                </button>
              </div>
              <div class="mb-3 w-100 d-flex justify-content-center align-item-center">
                <span class="">ยังไม่มีการ์ดใช่หรือไม่? <a href="#" id="CardCreate">สร้างการ์ดใหม่</a></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="/fonts/icon_fontawesome.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.14/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"></script>

    <script>
      $("#CardCreate").unbind();
      $("#CardCreate").on('click', () => {

        $("#modalCardCreate").modal("show");
        $('#contentCardCreate input').val('');

        $('#btn_CardCreate').unbind();
        $('#btn_CardCreate').on('click', () => {
          let CardName = $.trim($("#create_Name").val());
          let CardPass = $.trim($("#create_Pass").val());

          $.ajax({
            url: "/card/create",
            method: "post",
            contentType: "application/json",
            data: JSON.stringify({
              CardName: CardName,
              CardPass: CardPass,

            }),
            success: function (suc) {
              successText = suc.message;
              Swal.fire({
                position: "center",
                icon: "success",
                title: "Edit",
                text: successText,
                showConfirmButton: false,
                timer: 1500,
              });
              $("#modalCardCreate").modal("hide");


            },
            error: function (err) {
              errorText = err.responseJSON.message;
              Swal.fire({
                position: "center",
                icon: "warning",
                title: "Warning",
                text: errorText,
                showConfirmButton: true,
                confirmButtonText: "OK",
                confirmButtonColor: "#FF5733",
              });
            },
          });
        })
        $(".close").on('click', () => {
          $("#modalCardCreate").modal("hide");
        });
      })

      // Auth


      $('#btn_CardAuth').unbind();
      $('#btn_CardAuth').on('click', () => {
        let CardName = $.trim($("#auth_Name").val());
        let CardPass = $.trim($("#auth_Pass").val());

        $.ajax({
          url: "/card/auth",
          method: "post",
          contentType: "application/json",
          data: JSON.stringify({
            CardName: CardName,
            CardPass: CardPass,

          }),
          success: function (suc,) {
            console.log(suc)
            window.location.replace(suc.url)
            $('#auth_Name,#auth_Pass').val('');

          },
          error: function (err) {
            errorText = err.responseJSON.message;
            Swal.fire({
              position: "center",
              icon: "warning",
              title: "Warning",
              text: errorText,
              showConfirmButton: true,
              confirmButtonText: "OK",
              confirmButtonColor: "#FF5733",
            });

          },

        });

      })


    </script>

</body>

</html>